{
    "componentChunkName": "component---src-pages-blog-mdx-slug-js",
    "path": "/blog/2015-06-14-in-search-of-a-faster-query/",
    "result": {"data":{"mdx":{"frontmatter":{"title":"In search of a faster query","tags":["Rails","MySQL"],"categories":["programming"],"date":"June 14, 2015","image":null,"imageAlt":null},"id":"6cedd72c-880d-5cac-925f-c374d6b512c7","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"In search of a faster query\",\n  \"tags\": [\"Rails\", \"MySQL\"],\n  \"categories\": [\"programming\"],\n  \"date\": \"2015-06-14T00:00:00.000Z\",\n  \"draft\": false\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Recently, as I was fixing a minor bug in one of our applications at work, I had the opportunity to witness what a great difference a simple query can make.\"), mdx(\"p\", null, \"The bug involved a very slow query, that was doing a join between a couple of tables that had grown too large in size. The query, in Rails, was as follows:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-c\"\n  }, \"\\nModel1.joins(:model2).order(:attribute1)\\n\\n\")), mdx(\"p\", null, \"That query alone was taking nearly 2200 ms to complete, kind of showing that it really is the devil to make a join between two large tables. The table for Model1, for instance, had nearly 90,000 rows and 10+ columns, while the table for Model2 was slightly smaller, with nearly 30,000 rows.\"), mdx(\"p\", null, \"After examining the code, I realized we really only needed the id and attribute1 of Model1 records, so I modified the query slightly to retrieve only that:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-c\"\n  }, \"\\nModel1.select('attribute1, model1.id').joins(:model2).order(:attribute1)\\n\\n\")), mdx(\"p\", null, \"Wow! This simple change brought the time down to around 520 ms, which was still sluggish, but a great improvement from the 2200 ms we began with.\"), mdx(\"p\", null, \"It was a third iteration of the query, however, that made the most impact. We had a third table, for Model3, with an association to Model1 that we could use to our advantage. Although with no association between them, Model2 and Model3 both had a model1_id column, allowing us to do something like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-c\"\n  }, \"\\nmodel1_ids = Model3.joins('INNER JOIN model2 on model2.model1_id = model3.model1_id')\\n                   .uniq.pluck('model3.model1_id')\\nModel1.where(id: model1_ids).order(:attribute1)\\n\\n\")), mdx(\"p\", null, \"That last query brought the time down to around 40 ms. Not bad at all!\"), mdx(\"p\", null, \"I felt very pleased by this results, mostly because I learned it pays to play around with different ways to do the same, and to keep an eye on the query times reported in the console. It\\u2019s also worth thinking about how large the tables are likely to grow, although I know it\\u2019s hard to predict the future. It is possible when this part of the application was written, some time ago, that first query used to be fast enough, most likely because the table was small too.\"));\n}\n;\nMDXContent.isMDXComponent = true;","timeToRead":1,"slug":"2015-06-14-in-search-of-a-faster-query"},"allMdx":{"edges":[{"next":{"slug":"2013-03-17-silicon-valley-devfest/","frontmatter":{"title":"Silicon Valley DevFest"},"id":"12d078fb-e9f7-5a91-87d2-2aafc3fcc5f4"},"previous":null,"node":{"id":"3542588e-2f81-59e7-a2a5-b8e9cf9f0a48","frontmatter":{"title":"Makings of a Pythonista"},"slug":"2012-11-21-makings-of-a-pythonista"}},{"next":{"slug":"2015-06-14-in-search-of-a-faster-query","frontmatter":{"title":"In search of a faster query"},"id":"6cedd72c-880d-5cac-925f-c374d6b512c7"},"previous":{"frontmatter":{"title":"Makings of a Pythonista"},"slug":"2012-11-21-makings-of-a-pythonista"},"node":{"id":"12d078fb-e9f7-5a91-87d2-2aafc3fcc5f4","frontmatter":{"title":"Silicon Valley DevFest"},"slug":"2013-03-17-silicon-valley-devfest/"}},{"next":{"slug":"2015-11-01-diary-of-a-dev-joys-of-building","frontmatter":{"title":"Diary of a Junior Dev: The joys of building"},"id":"6ec420d1-e7c5-5d13-b71e-32ea695d605f"},"previous":{"frontmatter":{"title":"Silicon Valley DevFest"},"slug":"2013-03-17-silicon-valley-devfest/"},"node":{"id":"6cedd72c-880d-5cac-925f-c374d6b512c7","frontmatter":{"title":"In search of a faster query"},"slug":"2015-06-14-in-search-of-a-faster-query"}},{"next":{"slug":"2016-12-24-working-with-d3-based-chart-library/","frontmatter":{"title":"TIL: Working with a D3 based chart library"},"id":"391253e6-5f50-5691-b586-1d430f8beb54"},"previous":{"frontmatter":{"title":"In search of a faster query"},"slug":"2015-06-14-in-search-of-a-faster-query"},"node":{"id":"6ec420d1-e7c5-5d13-b71e-32ea695d605f","frontmatter":{"title":"Diary of a Junior Dev: The joys of building"},"slug":"2015-11-01-diary-of-a-dev-joys-of-building"}},{"next":{"slug":"2017-03-15-react-conf-2017/","frontmatter":{"title":"React Conf 2017"},"id":"b3b0738c-b465-5672-85e5-fbae6374cb60"},"previous":{"frontmatter":{"title":"Diary of a Junior Dev: The joys of building"},"slug":"2015-11-01-diary-of-a-dev-joys-of-building"},"node":{"id":"391253e6-5f50-5691-b586-1d430f8beb54","frontmatter":{"title":"TIL: Working with a D3 based chart library"},"slug":"2016-12-24-working-with-d3-based-chart-library/"}},{"next":{"slug":"2017-04-12-the-initial-state-gotcha","frontmatter":{"title":"The Initial State Gotcha"},"id":"a169418a-22c7-57bc-a5e5-d6af58083201"},"previous":{"frontmatter":{"title":"TIL: Working with a D3 based chart library"},"slug":"2016-12-24-working-with-d3-based-chart-library/"},"node":{"id":"b3b0738c-b465-5672-85e5-fbae6374cb60","frontmatter":{"title":"React Conf 2017"},"slug":"2017-03-15-react-conf-2017/"}},{"next":{"slug":"2017-05-13-blue-socks-at-orange/","frontmatter":{"title":"Blue Socks Spotted at Orange"},"id":"19c11caf-76ee-5725-9234-4afea701c637"},"previous":{"frontmatter":{"title":"React Conf 2017"},"slug":"2017-03-15-react-conf-2017/"},"node":{"id":"a169418a-22c7-57bc-a5e5-d6af58083201","frontmatter":{"title":"The Initial State Gotcha"},"slug":"2017-04-12-the-initial-state-gotcha"}},{"next":{"slug":"learning-gatsby/","frontmatter":{"title":"Learning about Gatsby"},"id":"f6e860b6-cacc-57d2-bb20-a69be5ffd347"},"previous":{"frontmatter":{"title":"The Initial State Gotcha"},"slug":"2017-04-12-the-initial-state-gotcha"},"node":{"id":"19c11caf-76ee-5725-9234-4afea701c637","frontmatter":{"title":"Blue Socks Spotted at Orange"},"slug":"2017-05-13-blue-socks-at-orange/"}},{"next":null,"previous":{"frontmatter":{"title":"Blue Socks Spotted at Orange"},"slug":"2017-05-13-blue-socks-at-orange/"},"node":{"id":"f6e860b6-cacc-57d2-bb20-a69be5ffd347","frontmatter":{"title":"Learning about Gatsby"},"slug":"learning-gatsby/"}}]}},"pageContext":{"id":"6cedd72c-880d-5cac-925f-c374d6b512c7","slug":"2015-06-14-in-search-of-a-faster-query","__params":{"slug":"2015-06-14-in-search-of-a-faster-query"}}},
    "staticQueryHashes": ["2201243204","2744905544"]}